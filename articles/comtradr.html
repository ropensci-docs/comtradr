<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="comtradr">
<title>comtradr ‚Ä¢ comtradr</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="comtradr">
<meta property="og:description" content="comtradr">
<meta property="og:image" content="https://docs.ropensci.org/comtradr/logo.png">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">comtradr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.4.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="active nav-item">
  <a class="nav-link" href="../articles/comtradr.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/caching.html">Caching requests from the UN Comtrade API</a>
    <a class="dropdown-item" href="../articles/large_data.html">Querying large amounts of data</a>
    <a class="dropdown-item" href="../articles/transition.html">Transition from old comtradr</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/comtradr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>comtradr</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/comtradr/blob/HEAD/vignettes/comtradr.Rmd" class="external-link"><code>vignettes/comtradr.Rmd</code></a></small>
      <div class="d-none name"><code>comtradr.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="data-availability">Data availability<a class="anchor" aria-label="anchor" href="#data-availability"></a>
</h2>
<p>See <a href="https://unstats.un.org/wiki/display/comtrade/New+Comtrade+FAQ+for+Advanced+Users?preview=/135004494/135004492/Picture1.png" class="external-link">here for an overview</a> of available commodity classifications.</p>
</div>
<div class="section level2">
<h2 id="package-information">Package information<a class="anchor" aria-label="anchor" href="#package-information"></a>
</h2>
<p>API wrapper for the <a href="https://comtradeplus.un.org/" class="external-link">UN Comtrade Database</a>. UN Comtrade provides historical data on the weights and value of specific goods shipped between countries, more info can be found <a href="https://unstats.un.org/wiki/display/comtrade" class="external-link">here</a>. Full API documentation can be found <a href="https://comtradedeveloper.un.org/" class="external-link">here</a>.</p>
</div>
<div class="section level2">
<h2 id="install-and-load-comtradr">Install and load comtradr<a class="anchor" aria-label="anchor" href="#install-and-load-comtradr"></a>
</h2>
<p>Install the development version from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"comtradr"</span><span class="op">)</span></span></code></pre></div>
<p>Load comtradr</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/comtradr/">comtradr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="authentication">Authentication üîê<a class="anchor" aria-label="anchor" href="#authentication"></a>
</h2>
<p><strong>Do not be discouraged by the complicated access to the token - you can do it! üí™</strong></p>
<p>As stated above, you need an API token, see the FAQ of Comtrade for details on how to obtain it:</p>
<p>‚û°Ô∏è <a href="https://unstats.un.org/wiki/display/comtrade/New+Comtrade+User+Guide#NewComtradeUserGuide-UNComtradeAPIManagement" class="external-link uri">https://unstats.un.org/wiki/display/comtrade/New+Comtrade+User+Guide#NewComtradeUserGuide-UNComtradeAPIManagement</a></p>
<p>You need to follow the detailed explanations, which include screenshots, in the Wiki of Comtrade to the letter. ‚òùÔ∏è I am not writing them out here, because they might be updated regularly. However, once you are signed up, select the <code>comtrade - v1</code> product, which is the free API.</p>
<div class="section level3">
<h3 id="storing-the-api-key">Storing the API key<a class="anchor" aria-label="anchor" href="#storing-the-api-key"></a>
</h3>
<p>If you are in an interactive session, you can call the following function to save your API token to the environment file for the current session.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/comtradr/">comtradr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/set_primary_comtrade_key.html">set_primary_comtrade_key</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>If you are not in an interactive session, you can register the token once in your session using the following base-r function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span><span class="st">'COMTRADE_PRIMARY'</span> <span class="op">=</span> <span class="st">'xxxxxxxxxxxxxxxxx'</span><span class="op">)</span></span></code></pre></div>
<p>If you would like to set the comtrade key permanently, we recommend editing the project <code>.Renviron</code> file, where you need to add a line with <code>COMTRADE_PRIMARY = xxxx-your-key-xxxx</code>.</p>
<p>‚ÑπÔ∏è Do not forget the line break after the last entry. This is the easiest by taking advantage of the great <code>usethis</code> package.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">edit_r_environ</span><span class="op">(</span>scope <span class="op">=</span> <span class="st">'project'</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="making-api-calls">Making API calls<a class="anchor" aria-label="anchor" href="#making-api-calls"></a>
</h2>
<p>Lets say we want to get data on the total imports into the United States from Germany, France, Japan, and Mexico, for the last five years.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ct_get_data.html">ct_get_data</a></span><span class="op">(</span></span>
<span>  reporter <span class="op">=</span> <span class="st">'USA'</span>,</span>
<span>  partner <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'DEU'</span>, <span class="st">'FRA'</span>,<span class="st">'JPN'</span>,<span class="st">'MEX'</span><span class="op">)</span>,</span>
<span>  commodity_code <span class="op">=</span> <span class="st">'TOTAL'</span>,</span>
<span>  start_date <span class="op">=</span> <span class="fl">2018</span>,</span>
<span>  end_date <span class="op">=</span> <span class="fl">2023</span>,</span>
<span>  flow_direction <span class="op">=</span> <span class="st">'import'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>API calls return a tidy data frame.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">example_1</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    20 obs. of  47 variables:</span></span>
<span><span class="co">#&gt;  $ type_code                 : chr  "C" "C" "C" "C" ...</span></span>
<span><span class="co">#&gt;  $ freq_code                 : chr  "A" "A" "A" "A" ...</span></span>
<span><span class="co">#&gt;  $ ref_period_id             : int  20180101 20180101 20180101 20180101 20190101 20190101 20190101 20190101 20200101 20200101 ...</span></span>
<span><span class="co">#&gt;  $ ref_year                  : int  2018 2018 2018 2018 2019 2019 2019 2019 2020 2020 ...</span></span>
<span><span class="co">#&gt;  $ ref_month                 : int  52 52 52 52 52 52 52 52 52 52 ...</span></span>
<span><span class="co">#&gt;  $ period                    : chr  "2018" "2018" "2018" "2018" ...</span></span>
<span><span class="co">#&gt;  $ reporter_code             : int  842 842 842 842 842 842 842 842 842 842 ...</span></span>
<span><span class="co">#&gt;  $ reporter_iso              : chr  "USA" "USA" "USA" "USA" ...</span></span>
<span><span class="co">#&gt;  $ reporter_desc             : chr  "USA" "USA" "USA" "USA" ...</span></span>
<span><span class="co">#&gt;  $ flow_code                 : chr  "M" "M" "M" "M" ...</span></span>
<span><span class="co">#&gt;  $ flow_desc                 : chr  "Import" "Import" "Import" "Import" ...</span></span>
<span><span class="co">#&gt;  $ partner_code              : int  251 276 392 484 251 276 392 484 251 276 ...</span></span>
<span><span class="co">#&gt;  $ partner_iso               : chr  "FRA" "DEU" "JPN" "MEX" ...</span></span>
<span><span class="co">#&gt;  $ partner_desc              : chr  "France" "Germany" "Japan" "Mexico" ...</span></span>
<span><span class="co">#&gt;  $ partner2code              : int  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ partner2iso               : chr  "W00" "W00" "W00" "W00" ...</span></span>
<span><span class="co">#&gt;  $ partner2desc              : chr  "World" "World" "World" "World" ...</span></span>
<span><span class="co">#&gt;  $ classification_code       : chr  "H5" "H5" "H5" "H5" ...</span></span>
<span><span class="co">#&gt;  $ classification_search_code: chr  "HS" "HS" "HS" "HS" ...</span></span>
<span><span class="co">#&gt;  $ is_original_classification: logi  TRUE TRUE TRUE TRUE TRUE TRUE ...</span></span>
<span><span class="co">#&gt;  $ cmd_code                  : chr  "TOTAL" "TOTAL" "TOTAL" "TOTAL" ...</span></span>
<span><span class="co">#&gt;  $ cmd_desc                  : chr  "All Commodities" "All Commodities" "All Commodities" "All Commodities" ...</span></span>
<span><span class="co">#&gt;  $ aggr_level                : int  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ is_leaf                   : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;  $ customs_code              : chr  "C00" "C00" "C00" "C00" ...</span></span>
<span><span class="co">#&gt;  $ customs_desc              : chr  "TOTAL CPC" "TOTAL CPC" "TOTAL CPC" "TOTAL CPC" ...</span></span>
<span><span class="co">#&gt;  $ mos_code                  : chr  "0" "0" "0" "0" ...</span></span>
<span><span class="co">#&gt;  $ mot_code                  : int  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ mot_desc                  : chr  "TOTAL MOT" "TOTAL MOT" "TOTAL MOT" "TOTAL MOT" ...</span></span>
<span><span class="co">#&gt;  $ qty_unit_code             : int  -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 ...</span></span>
<span><span class="co">#&gt;  $ qty_unit_abbr             : chr  "N/A" "N/A" "N/A" "N/A" ...</span></span>
<span><span class="co">#&gt;  $ qty                       : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ is_qty_estimated          : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;  $ alt_qty_unit_code         : int  -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 ...</span></span>
<span><span class="co">#&gt;  $ alt_qty_unit_abbr         : chr  "N/A" "N/A" "N/A" "N/A" ...</span></span>
<span><span class="co">#&gt;  $ alt_qty                   : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ is_alt_qty_estimated      : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;  $ net_wgt                   : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ is_net_wgt_estimated      : logi  TRUE TRUE TRUE TRUE TRUE TRUE ...</span></span>
<span><span class="co">#&gt;  $ gross_wgt                 : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ is_gross_wgt_estimated    : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;  $ cifvalue                  : num  5.36e+10 1.28e+11 1.46e+11 3.49e+11 5.85e+10 ...</span></span>
<span><span class="co">#&gt;  $ fobvalue                  : num  0.00 0.00 0.00 0.00 5.75e+10 ...</span></span>
<span><span class="co">#&gt;  $ primary_value             : num  5.36e+10 1.28e+11 1.46e+11 3.49e+11 5.85e+10 ...</span></span>
<span><span class="co">#&gt;  $ legacy_estimation_flag    : int  4 4 4 4 4 4 4 4 4 4 ...</span></span>
<span><span class="co">#&gt;  $ is_reported               : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;  $ is_aggregate              : logi  TRUE TRUE TRUE TRUE TRUE TRUE ...</span></span>
<span><span class="co">#&gt;  - attr(*, "url")= chr "https://comtradeapi.un.org/data/v1/get/C/A/HS?cmdCode=TOTAL&amp;flowCode=M&amp;partnerCode=280%2C251%2C276%2C392%2C250%"| __truncated__</span></span>
<span><span class="co">#&gt;  - attr(*, "time")= POSIXct[1:1], format: "2023-06-27 22:26:56"</span></span></code></pre></div>
<p>Here are a few more examples to show the different parameter options:</p>
<p>By default, the return data is in yearly amounts. We can pass <code>"monthly"</code> to arg <code>freq</code> to return data in monthly amounts, however the API limits each ‚Äúmonthly‚Äù query to a single year.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># all monthly data for a single year (API max of 12 months per call).</span></span>
<span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ct_search.html">ct_search</a></span><span class="op">(</span>reporters <span class="op">=</span> <span class="st">"USA"</span>,</span>
<span>               partners <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Germany"</span>, <span class="st">"France"</span>, <span class="st">"Japan"</span>, <span class="st">"Mexico"</span><span class="op">)</span>,</span>
<span>               flow_direction <span class="op">=</span> <span class="st">"import"</span>,</span>
<span>               start_date <span class="op">=</span> <span class="fl">2012</span>,</span>
<span>               end_date <span class="op">=</span> <span class="fl">2012</span>,</span>
<span>               freq <span class="op">=</span> <span class="st">"monthly"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># monthly data for specific span of months (API max of twelve months per call).</span></span>
<span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ct_search.html">ct_search</a></span><span class="op">(</span>reporters <span class="op">=</span> <span class="st">"USA"</span>,</span>
<span>               partners <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Germany"</span>, <span class="st">"France"</span>, <span class="st">"Japan"</span>, <span class="st">"Mexico"</span><span class="op">)</span>,</span>
<span>               flow_direction <span class="op">=</span> <span class="st">"import"</span>,</span>
<span>               start_date <span class="op">=</span> <span class="st">"2012-03"</span>,</span>
<span>               end_date <span class="op">=</span> <span class="st">"2012-07"</span>,</span>
<span>               freq <span class="op">=</span> <span class="st">"monthly"</span><span class="op">)</span></span></code></pre></div>
<p>Countries passed to parameters <code>reporters</code> and <code>partners</code> must be spelled as they appear in the official ISO 3 character code convention.</p>
<p>Search trade related to specific commodities (say, tomatoes). We can query the Comtrade commodity reference table to see all of the different commodity descriptions available for tomatoes.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ct_commodity_lookup.html">ct_commodity_lookup</a></span><span class="op">(</span><span class="st">"tomato"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $tomato</span></span>
<span><span class="co">#&gt; [1] "0702 - Tomatoes; fresh or chilled"                                                                                                         </span></span>
<span><span class="co">#&gt; [2] "070200 - Vegetables; tomatoes, fresh or chilled"                                                                                           </span></span>
<span><span class="co">#&gt; [3] "2002 - Tomatoes; prepared or preserved otherwise than by vinegar or acetic acid"                                                           </span></span>
<span><span class="co">#&gt; [4] "200210 - Vegetable preparations; tomatoes, whole or in pieces, prepared or preserved otherwise than by vinegar or acetic acid"             </span></span>
<span><span class="co">#&gt; [5] "200290 - Vegetable preparations; tomatoes, (other than whole or in pieces), prepared or preserved otherwise than by vinegar or acetic acid"</span></span>
<span><span class="co">#&gt; [6] "200950 - Juice; tomato, unfermented, not containing added spirit, whether or not containing added sugar or other sweetening matter"        </span></span>
<span><span class="co">#&gt; [7] "210320 - Sauces; tomato ketchup and other tomato sauces"</span></span></code></pre></div>
<p>If we want to search for shipment data on all of the commodity descriptions listed, then we can simply adjust the parameters for <code>ct_commodity_lookup</code> so that it will return only the codes, which can then be passed along to <code>ct_search</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tomato_codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ct_commodity_lookup.html">ct_commodity_lookup</a></span><span class="op">(</span><span class="st">"tomato"</span>,</span>
<span>                                    return_code <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                    return_char <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ct_get_data.html">ct_get_data</a></span><span class="op">(</span></span>
<span>  reporter <span class="op">=</span> <span class="st">'USA'</span>,</span>
<span>  partner <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'DEU'</span>, <span class="st">'FRA'</span>,<span class="st">'JPN'</span>,<span class="st">'MEX'</span><span class="op">)</span>,</span>
<span>  commodity_code <span class="op">=</span> <span class="va">tomato_codes</span>,</span>
<span>  start_date <span class="op">=</span> <span class="st">"2012"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2013"</span>,</span>
<span>  flow_direction <span class="op">=</span> <span class="st">'import'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>On the other hand, if we wanted to exclude juices and sauces from our search, we can pass a vector of the relevant codes to the API call.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ct_get_data.html">ct_get_data</a></span><span class="op">(</span></span>
<span>  reporter <span class="op">=</span> <span class="st">'USA'</span>,</span>
<span>  partner <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'DEU'</span>, <span class="st">'FRA'</span>,<span class="st">'JPN'</span>,<span class="st">'MEX'</span><span class="op">)</span>,</span>
<span>  commodity_code  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0702"</span>, <span class="st">"070200"</span>, <span class="st">"2002"</span>, <span class="st">"200210"</span>, <span class="st">"200290"</span><span class="op">)</span>,</span>
<span>  start_date <span class="op">=</span> <span class="st">"2012"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2013"</span>,</span>
<span>  flow_direction <span class="op">=</span> <span class="st">'import'</span></span>
<span><span class="op">)</span></span>
<span>               </span></code></pre></div>
</div>
<div class="section level2">
<h2 id="api-search-metadata">API search metadata<a class="anchor" aria-label="anchor" href="#api-search-metadata"></a>
</h2>
<p>In addition to the trade data, each API return object contains metadata as attributes.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The url of the API call.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">q</span><span class="op">)</span><span class="op">$</span><span class="va">url</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co"># The date-time of the API call.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">q</span><span class="op">)</span><span class="op">$</span><span class="va">time</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="more-on-the-lookup-functions">More on the lookup functions<a class="anchor" aria-label="anchor" href="#more-on-the-lookup-functions"></a>
</h2>
<p>Functions <code>ct_commodity_lookup</code> is able to take multiple search terms as input.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ct_commodity_lookup.html">ct_commodity_lookup</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tomato"</span>, <span class="st">"trout"</span><span class="op">)</span>, return_char <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "0702 - Tomatoes; fresh or chilled"                                                                                                                                                                                                                                     </span></span>
<span><span class="co">#&gt;  [2] "070200 - Vegetables; tomatoes, fresh or chilled"                                                                                                                                                                                                                       </span></span>
<span><span class="co">#&gt;  [3] "2002 - Tomatoes; prepared or preserved otherwise than by vinegar or acetic acid"                                                                                                                                                                                       </span></span>
<span><span class="co">#&gt;  [4] "200210 - Vegetable preparations; tomatoes, whole or in pieces, prepared or preserved otherwise than by vinegar or acetic acid"                                                                                                                                         </span></span>
<span><span class="co">#&gt;  [5] "200290 - Vegetable preparations; tomatoes, (other than whole or in pieces), prepared or preserved otherwise than by vinegar or acetic acid"                                                                                                                            </span></span>
<span><span class="co">#&gt;  [6] "200950 - Juice; tomato, unfermented, not containing added spirit, whether or not containing added sugar or other sweetening matter"                                                                                                                                    </span></span>
<span><span class="co">#&gt;  [7] "210320 - Sauces; tomato ketchup and other tomato sauces"                                                                                                                                                                                                               </span></span>
<span><span class="co">#&gt;  [8] "030191 - Fish; live, trout (Salmo trutta, Oncorhynchus mykiss, Oncorhynchus clarki, Oncorhynchus aguabonita, Oncorhynchus gilae, Oncorhynchus apache and Oncorhynchus chrysogaster)"                                                                                   </span></span>
<span><span class="co">#&gt;  [9] "030211 - Fish; fresh or chilled, trout (Salmo trutta, Oncorhynchus mykiss, Oncorhynchus clarki, Oncorhynchus aguabonita, Oncorhynchus gilae, Oncorhynchus apache and Oncorhynchus chrysogaster), excluding fillets, fish meat of 0304, and edible fish offal of 0302.9"</span></span>
<span><span class="co">#&gt; [10] "030314 - Fish; frozen, trout (Salmo trutta, Oncorhynchus mykiss, Oncorhynchus clarki, Oncorhynchus aguabonita, Oncorhynchus gilae, Oncorhynchus apache and Oncorhynchus chrysogaster), excluding fillets, meat of 0304, and edible fish offal of 0303.91 to 0303.99"   </span></span>
<span><span class="co">#&gt; [11] "030321 - Trout (Salmo trutta, Oncorhynchus mykiss/clarki/aguabonita/gilae/apache/chrysogaster), frozen (excl. fillets/other fish meat of 03.04/livers &amp; roes)"                                                                                                         </span></span>
<span><span class="co">#&gt; [12] "030442 - Fish fillets; fresh or chilled, trout (Salmo trutta, Oncorhynchus mykiss, Oncorhynchus clarki, Oncorhynchus aguabonita, Oncorhynchus gilae, Oncorhynchus apache and Oncorhynchus chrysogaster)"                                                               </span></span>
<span><span class="co">#&gt; [13] "030482 - Fish fillets; frozen, trout (Salmo trutta, Oncorhynchus mykiss, Oncorhynchus clarki, Oncorhynchus aguabonita, Oncorhynchus gilae, Oncorhynchus apache and Oncorhynchus chrysogaster)"                                                                         </span></span>
<span><span class="co">#&gt; [14] "030543 - Fish; smoked, whether or not cooked before or during smoking, trout (Salmo trutta, Oncorhynchus mykiss/clarki/aguabonita/gilae/apache/chrysogaster), includes fillets, but excludes edible fish offal"</span></span></code></pre></div>
<p><code>ct_commodity_lookup</code> can return a vector (as seen above) or a named list, using parameter <code>return_char</code></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ct_commodity_lookup.html">ct_commodity_lookup</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tomato"</span>, <span class="st">"trout"</span><span class="op">)</span>, return_char <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; $tomato</span></span>
<span><span class="co">#&gt; [1] "0702 - Tomatoes; fresh or chilled"                                                                                                         </span></span>
<span><span class="co">#&gt; [2] "070200 - Vegetables; tomatoes, fresh or chilled"                                                                                           </span></span>
<span><span class="co">#&gt; [3] "2002 - Tomatoes; prepared or preserved otherwise than by vinegar or acetic acid"                                                           </span></span>
<span><span class="co">#&gt; [4] "200210 - Vegetable preparations; tomatoes, whole or in pieces, prepared or preserved otherwise than by vinegar or acetic acid"             </span></span>
<span><span class="co">#&gt; [5] "200290 - Vegetable preparations; tomatoes, (other than whole or in pieces), prepared or preserved otherwise than by vinegar or acetic acid"</span></span>
<span><span class="co">#&gt; [6] "200950 - Juice; tomato, unfermented, not containing added spirit, whether or not containing added sugar or other sweetening matter"        </span></span>
<span><span class="co">#&gt; [7] "210320 - Sauces; tomato ketchup and other tomato sauces"                                                                                   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $trout</span></span>
<span><span class="co">#&gt; [1] "030191 - Fish; live, trout (Salmo trutta, Oncorhynchus mykiss, Oncorhynchus clarki, Oncorhynchus aguabonita, Oncorhynchus gilae, Oncorhynchus apache and Oncorhynchus chrysogaster)"                                                                                   </span></span>
<span><span class="co">#&gt; [2] "030211 - Fish; fresh or chilled, trout (Salmo trutta, Oncorhynchus mykiss, Oncorhynchus clarki, Oncorhynchus aguabonita, Oncorhynchus gilae, Oncorhynchus apache and Oncorhynchus chrysogaster), excluding fillets, fish meat of 0304, and edible fish offal of 0302.9"</span></span>
<span><span class="co">#&gt; [3] "030314 - Fish; frozen, trout (Salmo trutta, Oncorhynchus mykiss, Oncorhynchus clarki, Oncorhynchus aguabonita, Oncorhynchus gilae, Oncorhynchus apache and Oncorhynchus chrysogaster), excluding fillets, meat of 0304, and edible fish offal of 0303.91 to 0303.99"   </span></span>
<span><span class="co">#&gt; [4] "030321 - Trout (Salmo trutta, Oncorhynchus mykiss/clarki/aguabonita/gilae/apache/chrysogaster), frozen (excl. fillets/other fish meat of 03.04/livers &amp; roes)"                                                                                                         </span></span>
<span><span class="co">#&gt; [5] "030442 - Fish fillets; fresh or chilled, trout (Salmo trutta, Oncorhynchus mykiss, Oncorhynchus clarki, Oncorhynchus aguabonita, Oncorhynchus gilae, Oncorhynchus apache and Oncorhynchus chrysogaster)"                                                               </span></span>
<span><span class="co">#&gt; [6] "030482 - Fish fillets; frozen, trout (Salmo trutta, Oncorhynchus mykiss, Oncorhynchus clarki, Oncorhynchus aguabonita, Oncorhynchus gilae, Oncorhynchus apache and Oncorhynchus chrysogaster)"                                                                         </span></span>
<span><span class="co">#&gt; [7] "030543 - Fish; smoked, whether or not cooked before or during smoking, trout (Salmo trutta, Oncorhynchus mykiss/clarki/aguabonita/gilae/apache/chrysogaster), includes fillets, but excludes edible fish offal"</span></span></code></pre></div>
<p>For <code>ct_commodity_lookup</code>, if any of the input search terms return zero results and parameter <code>verbose</code> is set to <code>TRUE</code>, a warning will be printed to console (set <code>verbose</code> to <code>FALSE</code> to turn off this feature).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ct_commodity_lookup.html">ct_commodity_lookup</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tomato"</span>, <span class="st">"sldfkjkfdsklsd"</span><span class="op">)</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: There were no matching results found for inputs: sldfkjkfdsklsd</span></span>
<span><span class="co">#&gt; $tomato</span></span>
<span><span class="co">#&gt; [1] "0702 - Tomatoes; fresh or chilled"                                                                                                         </span></span>
<span><span class="co">#&gt; [2] "070200 - Vegetables; tomatoes, fresh or chilled"                                                                                           </span></span>
<span><span class="co">#&gt; [3] "2002 - Tomatoes; prepared or preserved otherwise than by vinegar or acetic acid"                                                           </span></span>
<span><span class="co">#&gt; [4] "200210 - Vegetable preparations; tomatoes, whole or in pieces, prepared or preserved otherwise than by vinegar or acetic acid"             </span></span>
<span><span class="co">#&gt; [5] "200290 - Vegetable preparations; tomatoes, (other than whole or in pieces), prepared or preserved otherwise than by vinegar or acetic acid"</span></span>
<span><span class="co">#&gt; [6] "200950 - Juice; tomato, unfermented, not containing added spirit, whether or not containing added sugar or other sweetening matter"        </span></span>
<span><span class="co">#&gt; [7] "210320 - Sauces; tomato ketchup and other tomato sauces"                                                                                   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $sldfkjkfdsklsd</span></span>
<span><span class="co">#&gt; character(0)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="api-rate-limits">API rate limits<a class="anchor" aria-label="anchor" href="#api-rate-limits"></a>
</h2>
<p>The Comtrade API imposes rate limits on users. <code>comtradr</code> features automated throttling of API calls to ensure the user stays within the limits defined by Comtrade. Below is a breakdown of those limits, API docs on these details can be found <a href="https://unstats.un.org/wiki/display/comtrade/New+Comtrade+FAQ+for+First+Time+Users" class="external-link">here</a>.</p>
<ul>
<li>Without user token: unlimited calls/day, up to 500 records per call (registration and API subscription key not required) ‚Äì this end-point is not implemented here.</li>
<li>With valid user token: 250 calls/day, up to 250,000 records per call (free registration and API subscription key required).</li>
</ul>
<p>The API also limits the amount of times it can be queried per minute, but we could not find documentation on this. Hence the function automatically responds to the parameters returned by each request to adjust to the changing wait times.</p>
<p>In addition to these rate limits, the API imposes some limits on parameter combinations.</p>
<ul>
<li>The arguments <code>reporters</code>, <code>partners</code> do not have an <code>All</code> value specified natively anymore, we have implemented it in R for convenience reasons on our side.</li>
<li>For date range the <code>start_date</code> and <code>end_date</code> must not span more than twelve months or twelve years. There is no more parameter to specify <code>All</code> years.</li>
<li>For arg <code>commodity_codes</code>, the maximum number of input values is dependent on the maximum length of the request. Hence, if specifying <code>reporters</code> or <code>partners</code>, this value might be shorter.</li>
</ul>
</div>
<div class="section level2">
<h2 id="package-data">Package Data<a class="anchor" aria-label="anchor" href="#package-data"></a>
</h2>
<p><code>comtradr</code> ships with a few different package data objects, and functions for interacting with and using the package data.</p>
<p><strong>Country/Commodity Reference Tables</strong></p>
<p>As explained previously, making API calls with <code>comtradr</code> often requires the user to query the commodity reference table (this is done using functions <code>ct_commodity_lookup</code>). These reference tables are generated by the UN Comtrade, and are updated roughly once a year. Since they‚Äôre updated infrequently, the tables are saved as cached data objects within the <code>comtradr</code> package, and are referenced by the package functions when needed.</p>
<p>The function features an <code>update</code> argument, that checks for updates, downloads the new tables if necessary and makes them available during the current R session. It will also print a message indicating whether updates were found, like so:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ct_commodity_lookup.html">ct_commodity_lookup</a></span><span class="op">(</span><span class="st">'tomato'</span>,update <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p>If any updates are found, the message will state which reference table(s) were updated.</p>
<p>Additionally, the Comtrade API features a number of different commodity reference tables, based on different trade data classification schemes (for more details, see <a href="https://unstats.un.org/wiki/display/comtrade/New+Comtrade+FAQ+for+Advanced+Users?preview=/135004494/135004492/Picture1.png" class="external-link">this</a> page from the API docs). <code>comtradr</code> ships with all available commodity reference tables. The user may return and access any of the available commodity tables by specifying arg <code>commodity_type</code> within function <code>ct_get_ref_table</code> (e.g., <code>ct_get_ref_table(dataset_id = "S1")</code> will return the commodity table that follows the ‚ÄúS1‚Äù scheme).</p>
<p>The <code>dataset_id</code>¬¥s are listed in the help page of the function <code><a href="../reference/ct_get_ref_table.html">ct_get_ref_table()</a></code>. They are as follows:</p>
<ul>
<li>Datasets that contain codes for the <code>commodity_code</code> argument. The name is the same as you would provide under <code>commodity_classification</code>.</li>
<li>‚ÄòHS‚Äô This is probably the most common classification for goods.</li>
<li>‚ÄòB4‚Äô</li>
<li>‚ÄòB5‚Äô</li>
<li>‚ÄòEB02‚Äô</li>
<li>‚ÄòEB10‚Äô</li>
<li>‚ÄòEB10S‚Äô</li>
<li>‚ÄòEB‚Äô</li>
<li>‚ÄòS1‚Äô</li>
<li>‚ÄòS2‚Äô</li>
<li>‚ÄòS3‚Äô</li>
<li>‚ÄòS4‚Äô</li>
<li>‚ÄòSS‚Äô</li>
<li>Datasets that are related to other arguments, can be queried directly with the name of the argument in the <code><a href="../reference/ct_get_data.html">ct_get_data()</a></code>-function.</li>
<li>‚Äòreporter‚Äô</li>
<li>‚Äòpartner‚Äô</li>
<li>‚Äòmode_of_transport‚Äô</li>
<li>‚Äòcustoms_code‚Äô</li>
</ul>
<p>Furthermore, there is a dataset readily available, with the iso3c-codes for the respective partner and reporter countries <code>country_codes$iso_3</code>, but I would recommend using the <code><a href="../reference/ct_get_ref_table.html">ct_get_ref_table()</a></code> function, as it allows to update to the latest values on the fly.</p>
</div>
<div class="section level2">
<h2 id="visualize">Visualize<a class="anchor" aria-label="anchor" href="#visualize"></a>
</h2>
<p>Once the data is collected, we can use it to create some basic visualizations.</p>
<p><strong>Plot 1</strong>: Plot total value (USD) of Chinese exports to Mexico, South Korea and the United States, by year.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Comtrade api query.</span></span>
<span><span class="va">example_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ct_get_data.html">ct_get_data</a></span><span class="op">(</span></span>
<span>  reporter <span class="op">=</span> <span class="st">'CHN'</span>,</span>
<span>  partner <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'KOR'</span>, <span class="st">'USA'</span>,<span class="st">'MEX'</span><span class="op">)</span>,</span>
<span>  commodity_code <span class="op">=</span> <span class="st">'TOTAL'</span>,</span>
<span>  start_date <span class="op">=</span> <span class="fl">2012</span>,</span>
<span>  end_date <span class="op">=</span> <span class="fl">2023</span>,</span>
<span>  flow_direction <span class="op">=</span> <span class="st">'export'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply polished col headers.</span></span>
<span><span class="co"># Create plot.</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">example_2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">period</span>, <span class="va">primary_value</span><span class="op">/</span><span class="fl">1000000000</span>, color <span class="op">=</span> <span class="va">partner_desc</span>, </span>
<span>                      group <span class="op">=</span> <span class="va">partner_desc</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span> values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkgreen"</span>,<span class="st">"red"</span>,<span class="st">"grey30"</span><span class="op">)</span>,</span>
<span>                      name <span class="op">=</span> <span class="st">"Destination\nCountry"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">'Export Value in billions'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">'Year'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Total Value (USD) of Chinese Exports"</span>, subtitle <span class="op">=</span> <span class="st">'by year'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, vjust <span class="op">=</span> <span class="fl">1</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="comtradr_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<p><strong>Plot 2</strong>: Plot the top eight destination countries/areas of Thai shrimp exports, by weight (KG), for 2007 - 2011.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, collect commodity codes related to shrimp.</span></span>
<span><span class="va">shrimp_codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ct_commodity_lookup.html">ct_commodity_lookup</a></span><span class="op">(</span><span class="st">"shrimp"</span>,</span>
<span>                                    return_code <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                    return_char <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Comtrade api query.</span></span>
<span><span class="va">example_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ct_get_data.html">ct_get_data</a></span><span class="op">(</span>reporter <span class="op">=</span> <span class="st">"THA"</span>,</span>
<span>                partner <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>                trade_direction <span class="op">=</span> <span class="st">"exports"</span>,</span>
<span>                start_date <span class="op">=</span> <span class="fl">2007</span>,</span>
<span>                end_date <span class="op">=</span> <span class="fl">2011</span>,</span>
<span>                commodity_code <span class="op">=</span> <span class="va">shrimp_codes</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Create country specific "total weight per year" dataframe for plotting.</span></span>
<span><span class="va">plotdf</span> <span class="op">&lt;-</span> <span class="va">example_3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">partner_desc</span>, <span class="va">period</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>kg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">net_wgt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Get vector of the top 8 destination countries/areas by total weight shipped</span></span>
<span><span class="co"># across all years, then subset plotdf to only include observations related</span></span>
<span><span class="co"># to those countries/areas.</span></span>
<span><span class="va">top8</span> <span class="op">&lt;-</span> <span class="va">plotdf</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">partner_desc</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>kg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">kg</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_max</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">8</span>, order_by <span class="op">=</span> <span class="va">kg</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">kg</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">partner_desc</span><span class="op">)</span></span>
<span><span class="va">plotdf</span> <span class="op">&lt;-</span> <span class="va">plotdf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">partner_desc</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">top8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create plots (y-axis is NOT fixed across panels, this will allow us to ID</span></span>
<span><span class="co"># trends over time within each country/area individually).</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plotdf</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">period</span>,<span class="va">kg</span><span class="op">/</span><span class="fl">1000</span>, group <span class="op">=</span> <span class="va">partner_desc</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">.</span><span class="op">~</span><span class="va">partner_desc</span>, nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">4</span>,scales <span class="op">=</span> <span class="st">'free_y'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Weight (KG in tons) of Thai Shrimp Exports"</span>, </span>
<span>       subtitle <span class="op">=</span><span class="st">"by Destination Area, 2007 - 2011"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>,hjust <span class="op">=</span> <span class="fl">1</span>, vjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="comtradr_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="handling-large-amounts-of-parameters">Handling large amounts of Parameters<a class="anchor" aria-label="anchor" href="#handling-large-amounts-of-parameters"></a>
</h2>
<p>In the <code>comtradr</code> package, several function parameters can accept <code>everything</code> as a valid input. Using <code>everything</code> for these parameters has specific meanings and can be a powerful tool for querying data. Internally, these values are set to <code>NULL</code> and the parameter is omitted entirely in the request to the API, the API then by default returns all possible values. Here‚Äôs a breakdown of how <code>everything</code> is handled for different parameters:</p>
<div class="section level3">
<h3 id="commodity_code">
<code>commodity_code</code><a class="anchor" aria-label="anchor" href="#commodity_code"></a>
</h3>
<p>Setting <code>commodity_code</code> to <code>everything</code> will query all possible commodity values. This can be useful if you want to retrieve data for all commodities without specifying individual codes.</p>
</div>
<div class="section level3">
<h3 id="flow_direction">
<code>flow_direction</code><a class="anchor" aria-label="anchor" href="#flow_direction"></a>
</h3>
<p>If <code>flow_direction</code> is set to <code>everything</code>, all possible values for trade flow directions are queried. This includes imports, exports, re-imports, re-exports and some more specified in <code>ct_get_ref_table('flow_direction')</code>.</p>
</div>
<div class="section level3">
<h3 id="reporter-and-partner">
<code>reporter</code> and <code>partner</code><a class="anchor" aria-label="anchor" href="#reporter-and-partner"></a>
</h3>
<p>Using <code>everything</code> for <code>reporter</code> or <code>partner</code> will query all possible values for reporter and partner countries, but also includes aggregates like <code>World</code> or some miscellaneous like <code>ASEAN</code>. Be careful when aggregating these values, so as to not count trade values multiple times in different aggregates. Alternatively, specifically for these values, you can also use <code>all_countries</code>, which allows you to query all countries which are not aggregates of some kind of grouped parameters like <code>ASEAN</code>. These values can usually be safely aggregated. This allows you to retrieve trade data for all countries without specifying individual ISO3 codes.</p>
</div>
<div class="section level3">
<h3 id="mode_of_transport-partner_2-and-customs_code">
<code>mode_of_transport</code>, <code>partner_2</code>, and <code>customs_code</code><a class="anchor" aria-label="anchor" href="#mode_of_transport-partner_2-and-customs_code"></a>
</h3>
<p>Setting these parameters to <code>everything</code> will query all possible values related to the mode of transport, secondary partner, and customs procedures. This provides a comprehensive view of the data across different transportation modes and customs categories.</p>
</div>
<div class="section level3">
<h3 id="example-usage">Example Usage<a class="anchor" aria-label="anchor" href="#example-usage"></a>
</h3>
<p>Here‚Äôs an example of how you might use <code>everything</code> parameters to query comprehensive data:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Querying all commodities and flow directions for USA and Germany from </span></span>
<span><span class="co">## 2010 to 2011</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ct_get_data.html">ct_get_data</a></span><span class="op">(</span></span>
<span>  reporter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'USA'</span>, <span class="st">'DEU'</span><span class="op">)</span>,</span>
<span>  commodity_code <span class="op">=</span> <span class="st">'everything'</span>,</span>
<span>  flow_direction <span class="op">=</span> <span class="st">'everything'</span>,</span>
<span>  start_date <span class="op">=</span> <span class="st">'2010'</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">'2011'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Using <code>everything</code> parameters can lead to large datasets, as they often remove specific filters on the data. It‚Äôs essential to be mindful of the size of the data being queried, especially when using multiple <code>everything</code> parameters simultaneously.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
